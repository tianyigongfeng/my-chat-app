<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>陪伴康复聊天</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 10px;
      background: #f5f5f5;
    }
    #chat {
      height: 70vh;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 10px;
      background: white;
      margin-bottom: 10px;
    }
    #input {
      width: 80%;
      padding: 8px;
    }
    #send {
      width: 15%;
      padding: 8px;
    }
    .user { color: blue; }
    .bot { color: green; }
  </style>
</head>
<body>
  <h2>陪伴康复聊天机器人</h2>
  <div id="chat"></div>
  <input type="text" id="input" placeholder="输入你的问题..." />
  <button id="send">发送</button>

  <script>
    const API_KEY = "sk-a78d335efcd9493e87914d622eb84d5b"; // ←←← 替换成你的真实 API-KEY
    const APP_ID = "79b899b07e9049aaa43c95af14686e2c";         // ←←← 替换成你的百炼应用 ID（在百炼控制台查看）

    const chatDiv = document.getElementById("chat");
    const inputBox = document.getElementById("input");
    const sendBtn = document.getElementById("send");

    function addMessage(text, isUser) {
      const p = document.createElement("p");
      p.className = isUser ? "user" : "bot";
      p.innerText = (isUser ? "你: " : "机器人: ") + text;
      chatDiv.appendChild(p);
      chatDiv.scrollTop = chatDiv.scrollHeight;
    }

    async function sendMessage(message) {
      if (!message.trim()) return;

      addMessage(message, true);
      inputBox.value = "";

      try {
        const response = await fetch("https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation", {
          method: "POST",
          headers: {
            "Authorization": `Bearer  $ {API_KEY}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            model: "your-model-name", // ←←← 替换为你的模型名（如 qwen-max）
            input: {
              messages: [
                { role: "user", content: message }
              ]
            },
            parameters: {}
          })
        });

        const data = await response.json();
        console.log(data);

        if (data.output && data.output.text) {
          addMessage(data.output.text, false);
        } else {
          addMessage("抱歉，我无法回答这个问题。", false);
        }
      } catch (err) {
        console.error(err);
        addMessage("网络错误，请检查设置。", false);
      }
    }

    sendBtn.onclick = () => sendMessage(inputBox.value);
    inputBox.onkeypress = (e) => {
      if (e.key === "Enter") sendMessage(inputBox.value);
    };
  </script>
</body>
</html>